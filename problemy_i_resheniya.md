# Проблемы системы перевода и рекомендации по их устранению

## Список проблем и рекомендаций

### 1. Отставание перевода

**Проблема**: 
- Человек говорит на английском очень быстро
- Перевод на русский звучит долго
- Нужно ускорить произведение перевода на русский
- Цель: нужно уменьшить отставание при любой скорости спикера
- Чем больше говорит человек на англт = тем больше отставание перевода
- Цель: нужно уменьшить отставание при любой скорости спикера

**Текущие решения**:
- В игре и уоих есть скорость говорения — можно с ним поиграть
- Ставим модели эту задачу перевести с определенным количеством слов для вывода на каждые хх сек в проценте (как делает в инво)
- Добобучить создать свои голоса (в будущем хотим кланировать голос)
- Мы вставляем врезы между фразами TTS, с этим можно экспериментировать что-то сделать

**Дополнительные рекомендации**:
- **Оптимизация Whisper API**: Перейти на `faster_whisper` или `insanely_faster_whisper` с квантизацией моделей для снижения задержки распознавания
- **Буферизация VAD**: Улучшить детектор голосовой активности для более раннего определения конца фразы, что позволит начинать перевод до полного завершения высказывания
- **Параллельный конвейер**: Реализовать параллельную обработку, где перевод начинается сразу после распознавания первого значимого фрагмента речи, не дожидаясь завершения полной фразы
- **Сегментация потока**: Уменьшить минимальную длину сегмента для обработки в `HypothesisBuffer`, чтобы начинать обработку раньше

### 2. Падежи и несостыковки слов

**Проблема**:
- Слова не сочетаются по родам/падежам, приставкам, окончаниям
- Слова в предложении должны быть согласованы между собой по падежу и адекватно состыковываться по окончаниям, родам, приставкам, предлогам
- Пример: "Собранных у меня тысяча шестьсот человек" должно быть "собранных у одной тысячи шестьсот человек"

**Дополнительные рекомендации**:
- **Пост-обработка LLM**: Добавить дополнительный этап проверки морфологической согласованности через специализированную модель (например, использовать морфологический анализатор pymorphy2)
- **Контекстный буфер для Gemma**: Увеличить контекстное окно для Gemma, чтобы модель видела больше предыдущего текста и лучше согласовывала окончания
- **Морфологические правила**: Внедрить правила согласования по родам и падежам для наиболее частотных конструкций
- **Промпт-инжиниринг**: Оптимизировать промпты для Gemma с явными инструкциями о необходимости согласования слов в русском языке

### 3. Названия компаний и имена

**Проблема**:
- Имена людей, названия компаний, названия продуктов: все это передается и звучит плохо
- Стоит оставить их на изначальном языке и качественно произносить на изначальном языке

**Дополнительные рекомендации**:
- **База именованных сущностей**: Создать и интегрировать базу данных часто используемых имен компаний и людей с правильным произношением
- **Предварительная транслитерация**: Добавить специальный модуль транслитерации для имен и названий компаний перед передачей в TTS
- **Механизм сохранения**: В `tts_grpc_api` добавить маркеры специальных сущностей (имена, названия), которые не должны переводиться, а транслитерироваться
- **Обучение модели Gemma**: Дообучить модель Gemma на корпусе текстов с правильными переводами имен и названий компаний

### 4. Болят уши от озвучки и звука

**Проблема**:
- Слушаем на наушнике Bosch, который в реальной жизни будет у клиентов в зале
- Звук бьёт по ушам
- Есть дребезжание и сама тональность голоса режет уxо
- Цель: приятно и комфортно слушать 2 часа без перерыва
- Окончание предложения иногда съедается при озвучке и не слышно часть
- Некоторые слова произносятся плохо
- Есть ошибки в ударениях

**Дополнительные рекомендации**:
- **Улучшенный AudioProcessor**: В `tts_grpc_api` расширить функционал `AudioProcessor` и `StreamVolumeController`, добавив:
  - Динамическую компрессию звука для выравнивания громкости
  - Эквализацию для уменьшения резких частот
  - Ограничитель пиковой громкости (лимитер)
- **Варьирование просодии**: Модифицировать параметры синтеза речи для более естественной интонации (менее монотонной)
- **Адаптивная громкость**: Реализовать адаптивную регулировку громкости в зависимости от длительности сессии
- **Аудио-фильтры**: Добавить фильтры для снижения резкости высоких частот, которые чаще вызывают утомление

### 5. Голос мямлит и плохо произносит

**Проблема**:
- Голос мямлит и плохо произносит некоторые слова, делает ошибки в ударениях
- Цель: наша озвучка должна звучать как профессиональный диктор, который правильно произносит каждое слово

**Дополнительные рекомендации**:
- **Выбор оптимальной модели Piper**: Система использует Piper TTS с ONNX моделями. Рекомендуется:
  - Тестирование и выбор модели с лучшей артикуляцией для русского языка
  - Настройка параметров `length_scale` и `noise_scale` для более четкого произношения
- **Фонемное усиление**: В `Phonemizer` добавить усиление сложных фонем и согласных для более четкого произношения
- **Пост-обработка текста**: Реализовать улучшенную обработку текста перед синтезом с расстановкой ударений в сложных словах
- **Специальная обработка окончаний**: Добавить логику, которая обеспечит выделение окончаний предложений (замедление, усиление артикуляции)

## Общие рекомендации по улучшению системы

1. **Обратная связь от пользователей**: Реализовать механизм сбора оценки качества перевода и синтеза речи в режиме реального времени для постоянного улучшения

2. **Модульные тесты**: Создать комплексные тесты для оценки качества перевода и синтеза, особенно для проблемных случаев (имена, специальные термины)

3. **Кэширование переводов**: Внедрить кэширование часто используемых фраз и терминов для ускорения обработки и обеспечения единообразия перевода

4. **Адаптивные параметры**: Настраивать параметры системы (скорость, тон, громкость) в зависимости от характеристик входящей речи

5. **Специализированные промпты**: Создать набор промптов для Gemma, специально оптимизированных для разных типов контента (техническая речь, презентации, диалоги)
